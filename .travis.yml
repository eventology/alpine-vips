dist: trusty
sudo: required
language: generic
auth: &Auth |
  eval "$(npx travis-env)"

before_script:
  - *Auth
  - docker --version # document the version travis is using
  - pip install --user awscli # install aws cli w/o sudo
  - export PATH=$PATH:$HOME/.local/bin # put aws in the path
  - eval $(aws ecr get-login --no-include-email --region us-east-1) #needs AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY envvars
jobs:
  include:
    - stage: build
      name: Build latest tag
      script:
        - docker build -t fan-guru/alpine-vips:latest .
        - docker tag fan-guru/alpine-vips:latest 712623285669.dkr.ecr.us-east-1.amazonaws.com/fan-guru/alpine-vips:latest
        - docker push 712623285669.dkr.ecr.us-east-1.amazonaws.com/fan-guru/alpine-vips:latest
stages:
  - build
